package com.test.serviceimpl;

import java.util.Comparator;
import java.util.List;

import com.test.datastore.DataStore;
import com.test.exception.InvalidVehicleException;
import com.test.model.Vehicle;
import com.test.model.VehicleType;
import com.test.service.VehicleService;
import com.test.template.VehicleTemplate;
import com.test.validation.VehicleValidation;

public class VehicleServiceImpl implements VehicleService{
	 private VehicleValidation vv;

	    @Override
	    public void addVehicle(Vehicle vehicle) {
	        
	    	VehicleValidation.validate(vehicle);
	        DataStore.vehicles.add(vehicle);
	    }

	    @Override
	    public double calculateVehicleTax(String regNo) {
	        Vehicle vehicle = getVehicleByRegistrationNumber(regNo);
	        if(vehicle==null) {
	        	throw new InvalidVehicleException("Vehicle not found with Registration Number: " + regNo);
	        }

	        double tax = 0;
	        VehicleType type = vehicle.getVehicletype();
	        if (type == VehicleType.petrol) {
	            tax = vehicle.getMaxvelocity() + vehicle.getCapacity() + 0.1 * vehicle.getPurchasecost();
	        } else if (type == VehicleType.diesel) {
	            tax = vehicle.getMaxvelocity() + vehicle.getCapacity() + 0.11 * vehicle.getPurchasecost();
	        } else if (type == VehicleType.cng_lpg) {
	            tax = vehicle.getMaxvelocity() + vehicle.getCapacity() + 0.12 * vehicle.getPurchasecost();
	        }

	        vehicle.setVehicletax(tax);
	        return tax;
	    }

	    @Override
	    public void getAllVehicles() {
	        DataStore.vehicles.sort(Comparator.comparing(Vehicle::getRegistrationnumber));
	        VehicleTemplate.printHeader();
	        VehicleTemplate.printData(DataStore.vehicles);
	        VehicleTemplate.printFooter();
	    }

	    @Override
	    public Vehicle getVehicleByRegistrationNumber(String regNo) {
	        for (Vehicle v : DataStore.vehicles) {
	            if (v.getRegistrationnumber() == regNo) {
	                return v;
	            }
	        }
	        return null;
	    }
}

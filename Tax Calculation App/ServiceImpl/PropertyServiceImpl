package com.test.serviceimpl;

import java.util.ArrayList;
import java.util.Comparator;
import java.util.List;

import com.test.datastore.DataStore;
import com.test.exception.InvalidPropertyException;
import com.test.model.Property;
import com.test.service.PropertyService;
import com.test.template.PropertyTemplate;
import com.test.validation.PropertyValidation;

public class PropertyServiceImpl implements PropertyService{
    private int generatedId = 1;


    @Override
    public void addProperty(Property property) {
    	PropertyValidation.validate(property);
        property.setPropertyid(generatedId++);
        DataStore.properties.add(property);
    }

    
    @Override
    public double calculatePropertyTax(int id) {
        Property p = getPropertyById(id);
        if (p == null) {
        	throw new InvalidPropertyException("Property not found with ID: " + id);
        }

        double tax = 0;
        if(p.isIsinmaincity()) {
        	tax=(p.getBuiltuparea() * p.getAge()* 0.2 * p.getBasevalue()) + (0.5 * p.getBuiltuparea());
        }
        else {
        	tax = p.getBuiltuparea() * p.getAge()* 0.2 * p.getBasevalue();
        }

        p.setPropertytax(tax);
        return tax;
    }

    
    @Override
    public void getAllProperties() {
    	PropertyTemplate.printHeader();
    	 DataStore.properties.sort(Comparator.comparingInt(Property::getPropertyid));
    	 PropertyTemplate.printData(DataStore.properties);
    	 PropertyTemplate.printFooter();
    }

    @Override
    public Property getPropertyById(int id) {
        for (Property p : DataStore.properties) {
            if (p.getPropertyid() == id)
                return p;
        }
        return null;
    }
}
